<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Diagnosis Diabetes</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">

<div class="bg-white p-8 rounded-xl shadow-lg w-full max-w-xl">
    <h2 class="text-2xl font-bold text-center mb-6">Diagnosis Diabetes</h2>

    <form id="diagnosisForm" class="space-y-4">
        <input id="nama" class="w-full p-2 border rounded" placeholder="Nama Lengkap" required>
        <input id="usia" type="number" class="w-full p-2 border rounded" placeholder="Usia" required>

        <select id="jenis_kelamin" class="w-full p-2 border rounded" required>
            <option value="">Pilih Jenis Kelamin</option>
            <option value="L">Laki-laki</option>
            <option value="P">Perempuan</option>
        </select>

        <div>
            <h3 class="font-semibold mb-2">Gejala</h3>
            <div id="gejalaContainer" class="space-y-2"></div>
        </div>

        <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
            Proses Diagnosis
        </button>
    </form>

    <div id="hasil" class="mt-6 text-center"></div>
</div>

<script>
/* ðŸ”¥ LOGIC TETAP SAMA â€” TIDAK DIUBAH */
const API = '';

async function loadSymptoms() {
    const res = await fetch('/symptoms');
    const data = await res.json();

    const box = document.getElementById('gejalaContainer');
    box.innerHTML = '';

    data.forEach(g => {
        box.innerHTML += `
            <label class="flex items-center gap-2">
                <input type="checkbox" value="${g.id}" data-bobot="${g.bobot}">
                ${g.nama_gejala}
            </label>
        `;
    });
}

loadSymptoms();

document.getElementById('diagnosisForm').addEventListener('submit', async e => {
    e.preventDefault();

    const nama = nama.value;
    const usia = usia.value;
    const jk = jenis_kelamin.value;

    const u = await fetch('/users', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nama_lengkap: nama, usia, jenis_kelamin: jk })
    }).then(r => r.json());

    let skor = 0;
    document.querySelectorAll('input:checked').forEach(c => skor += +c.dataset.bobot);

    let risiko = skor >= 0.7 ? 'Tinggi' : skor >= 0.4 ? 'Sedang' : 'Rendah';

    await fetch('/diagnoses', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
            user_id: u.id,
            tingkat_risiko: risiko,
            skor_akhir: skor,
            rekomendasi_khusus: 'Jaga pola hidup sehat'
        })
    });

    hasil.innerHTML = `
        <h3 class="text-xl font-bold">Hasil Diagnosis</h3>
        <p class="mt-2">Risiko: <b>${risiko}</b></p>
        <p>Skor: ${skor.toFixed(2)}</p>
    `;
});
</script>

</body>
</html>
